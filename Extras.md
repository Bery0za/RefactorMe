- Не работать напрямую с DbContent, а использовать интерфейсы с паттерном Repository, Unit of Work (отделить хранилище данных от бизнес-логики, упростить тестирование).
- Использовать DI вместо инстанцирования DbContext. Передавать интерфейсы Repository через конструктор в SurveyService.
- Вынести логику методов из SurveyService в отдельные классы, использовать SurveyService только для роутинга, конвертирования dto. Использовать MediatR или подобные механики с асбтрагированием кокретных handlers (для каждой команды/запроса). К абстракциям можно будет с помощью паттерна декоратор добавить авторизацию, логгирование, кэширование и т. д.
- Использовать иерархию классов для разных типов SurveyQuestion для более чёткого отображения бизнес-логики, использовать TPH в EF Core. Вынести подсчёт правильных ответов пользователя в отдельный метод в SurveyQuestion и перегружать его в наследниках (либо использовать Visitor для разных типов наследников), в классе, подводящем подсчёт, использовать этот метод: это позволит при расширении типов вопросов не изменять каждый раз общую логику подсчёта.
- Использовать иерархию классов для SurveyAnswerDto аналогично SurveyQuestion.
- Имплементировать необходимую бизнес-логику в классах модели (добавить конструкторы с обязательными параметрами, сделать необходимые сеттеры приватными).
- Добавить механизм проверки версии опроса или сделать Survey полностью immutable и добавить к нему версионность, чтобы сохранение результата опроса не приводило к нарушениям логики, если результат пришёл после того, как опрос был изменён.
- Использовать DateTime.UtcNow